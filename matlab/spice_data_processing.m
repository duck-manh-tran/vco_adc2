
F_sample = 24*10^6;
OSR=500;
T = 41.67*10^-9;
t_trans=10.05*10^-3;
t=[20*10^-6:T:t_trans].';
t_s=[20*10^-6:T*OSR:t_trans].';
ADC_samples = readtable('./Workspace/data_Acous@115dB_SPL_5.txt', 'Delimiter',' ','ReadVariableNames',false, 'Format', '%d%f%f', 'HeaderLines', 0);
ADC_samples.Properties.VariableNames = {'NaN' 'anlg_in' 'Dout'};
ADC_samples.Dout = round(ADC_samples.Dout)/2;
figure(1);
subplot (1,2,1);
index = length(ADC_samples.anlg_in);
plot (t(2:index+1), ADC_samples.anlg_in);
xticks(0:0.1*10^-3:5.1*10^-3);
xlim([0 2.1*10^-3]);
grid on;
output_sinc =decimation(ADC_samples.Dout, F_sample, OSR);
subplot (1,2,2);
index = length(output_sinc);
plot (t_s(4:index), output_sinc(4:end));
xticks(0:0.1*10^-3:5.1*10^-3);
xlim([0 2.1*10^-3]);
grid on;
figure(2);
L_fft = 2048*22;
qtz = ADC_samples.Dout.';
plot_fft(qtz-mean(qtz), F_sample, L_fft);
x_const= [24000 24000];
y_var = [-160 0];
hold on;
plot (x_const, y_var, 'LineWidth',1.75);
ylim ([-90 0]);